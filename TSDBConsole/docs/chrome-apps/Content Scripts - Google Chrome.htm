<!DOCTYPE html>
<!-- saved from url=(0053)http://developer.chrome.com/apps/content_scripts.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Content Scripts - Google Chrome</title>
    
    <link href="./Content Scripts - Google Chrome_files/site.css" rel="stylesheet" type="text/css">
    <link href="./Content Scripts - Google Chrome_files/print.css" rel="stylesheet" type="text/css" media="print">
    <link href="./Content Scripts - Google Chrome_files/prettify.css" rel="stylesheet" type="text/css">
    <link href="./Content Scripts - Google Chrome_files/css" rel="stylesheet" type="text/css">
    <script async="" src="./Content Scripts - Google Chrome_files/analytics.js"></script><script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-41980257-1');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
    <div id="gc-topnav">
      <table><tbody><tr>
      <td id="chrome-logo">
        <a href="http://developer.chrome.com/apps/" title="Google Chrome Apps">
          <img src="./Content Scripts - Google Chrome_files/chrome-logo.png" alt=""> chrome
        </a>
        <div id="platform-chooser">
          <button id="platform-chooser-toggle" data-menu="platform-chooser-popup">
            apps ▾ 
          </button>
          <div id="platform-chooser-popup">
            <button class="apps" data-href="/apps/about_apps.html">apps</button>
            <button class="extensions" data-href="/extensions">extensions</button>
          </div>
        </div>
      </td>
      <td>
        <ul>
          <li>
            <a href="http://developer.chrome.com/apps/samples.html" title="Sample Apps (with source code)">Samples</a>
          </li>
          <li>
            <a href="http://groups.google.com/a/chromium.org/group/chromium-apps" title="Google Chrome Apps developer forum" target="_blank">Group</a>
          </li>
          <li>
            <a href="http://stackoverflow.com/tags/google-chrome-app/info" title="[google-chrome-app] tag on Stack Overflow" target="_blank">Stack overflow</a>
          </li>
        </ul>
      </td>
      </tr></tbody></table>
    </div>
    <div id="gc-topnav-space"></div>
    <div id="gc-container">
      <div id="gc-sidebar">
        <ul class="level1 ">
        <li class="level2">
              <span class="level2">Discover</span>
          <ul class="level2 ">
          <li class="level3">
                <a href="http://developer.chrome.com/apps/about_apps.html" class="level3 ">What Are Chrome Apps?</a>
          </li>
          </ul>
        </li><li class="level2">
              <span class="level2">Develop</span>
          <ul class="level2 ">
          <li class="level3">
                <a href="http://developer.chrome.com/apps/first_app.html" class="level3 ">Create Your First App</a>
          </li><li class="level3">
              <a class="button level3" href="javascript:void(0)">
                <span class="level3">Tutorials</span>
                <div class="toggleIndicator level3"></div>
              </a>
            <ul toggleable="" class="level3 hidden">
            <li class="level4">
                <a class="button level4" href="javascript:void(0)">
                  <span class="level4">Learn with a Codelab</span>
                  <div class="toggleIndicator level4"></div>
                </a>
              <ul toggleable="" class="level4 hidden">
              <li class="level5">
                    <a href="http://developer.chrome.com/apps/app_codelab.html" class="level5 ">About this Codelab</a>
              </li><li class="level5">
                    <a href="http://developer.chrome.com/apps/app_codelab1_setup.html" class="level5 ">1 - Set Up Development Environment</a>
              </li><li class="level5">
                    <a href="http://developer.chrome.com/apps/app_codelab2_basic.html" class="level5 ">2 - Create Basic App</a>
              </li><li class="level5">
                    <a href="http://developer.chrome.com/apps/app_codelab3_mvc.html" class="level5 ">3 - Create MVC</a>
              </li><li class="level5">
                    <a href="http://developer.chrome.com/apps/app_codelab5_data.html" class="level5 ">4 - Save and Fetch Data</a>
              </li><li class="level5">
                    <a href="http://developer.chrome.com/apps/app_codelab6_lifecycle.html" class="level5 ">5 - Manage App Lifecycle</a>
              </li><li class="level5">
                    <a href="http://developer.chrome.com/apps/app_codelab7_useridentification.html" class="level5 ">6 - Access User's Data</a>
              </li><li class="level5">
                    <a href="http://developer.chrome.com/apps/app_codelab8_webresources.html" class="level5 ">7 - Access Web Resources</a>
              </li><li class="level5">
                    <a href="http://developer.chrome.com/apps/app_codelab_10_publishing.html" class="level5 ">8 - Publish App</a>
              </li>
              </ul>
            </li><li class="level4">
                <a class="button level4" href="javascript:void(0)">
                  <span class="level4">MVC Architecture &amp; Frameworks</span>
                  <div class="toggleIndicator level4"></div>
                </a>
              <ul toggleable="" class="level4 hidden">
              <li class="level5">
                    <a href="http://developer.chrome.com/apps/app_frameworks.html" class="level5 ">About MVC Architecture</a>
              </li><li class="level5">
                    <a href="http://developer.chrome.com/apps/angular_framework.html" class="level5 ">Build Apps with AngularJS</a>
              </li><li class="level5">
                    <a href="http://developer.chrome.com/apps/sencha_framework.html" class="level5 ">Build Apps with Sencha Ext JS</a>
              </li>
              </ul>
            </li>
            </ul>
          </li><li class="level3">
              <a class="button level3" href="javascript:void(0)">
                <span class="level3">Chrome App Concepts</span>
                <div class="toggleIndicator level3"></div>
              </a>
            <ul toggleable="" class="level3 hidden">
            <li class="level4">
                <a class="button level4" href="javascript:void(0)">
                  <span class="level4">The Fundamentals</span>
                  <div class="toggleIndicator level4"></div>
                </a>
              <ul toggleable="" class="level4 hidden">
              <li class="level5">
                    <a href="http://developer.chrome.com/apps/app_architecture.html" class="level5 ">App Architecture</a>
              </li><li class="level5">
                    <a href="http://developer.chrome.com/apps/app_lifecycle.html" class="level5 ">App Lifecycle</a>
              </li><li class="level5">
                    <a href="http://developer.chrome.com/apps/offline_apps.html" class="level5 ">Offline First</a>
              </li><li class="level5">
                    <a href="http://developer.chrome.com/apps/app_external.html" class="level5 ">External Content</a>
              </li>
              </ul>
            </li><li class="level4">
                <a class="button level4" href="javascript:void(0)">
                  <span class="level4">Security</span>
                  <div class="toggleIndicator level4"></div>
                </a>
              <ul toggleable="" class="level4 hidden">
              <li class="level5">
                    <a href="http://developer.chrome.com/apps/contentSecurityPolicy.html" class="level5 ">Content Security Policy</a>
              </li>
              </ul>
            </li><li class="level4">
                <a class="button level4" href="javascript:void(0)">
                  <span class="level4">Cloud-Enable Your App</span>
                  <div class="toggleIndicator level4"></div>
                </a>
              <ul toggleable="" class="level4 hidden">
              <li class="level5">
                  <a class="button level5" href="javascript:void(0)">
                    <span class="level5">Cloud Messaging</span>
                    <div class="toggleIndicator level5"></div>
                  </a>
                <ul toggleable="" class="level5 hidden">
                <li class="level6">
                      <a href="http://developer.chrome.com/apps/cloudMessaging.html" class="level6 ">About Cloud Messaging</a>
                </li><li class="level6">
                      <a href="http://developer.chrome.com/apps/pushMessaging.html" class="level6 ">Client Reference</a>
                </li><li class="level6">
                      <a href="http://developer.chrome.com/apps/gcm_server.html" class="level6 ">Service Reference</a>
                </li><li class="level6">
                      <a href="http://developer.chrome.com/apps/gcm_tos.html" class="level6 ">Terms of Service</a>
                </li>
                </ul>
              </li><li class="level5">
                  <a class="button level5" href="javascript:void(0)">
                    <span class="level5">Cloud Storage</span>
                    <div class="toggleIndicator level5"></div>
                  </a>
                <ul toggleable="" class="level5 hidden">
                <li class="level6">
                      <a href="http://developer.chrome.com/apps/storage.html" class="level6 ">chrome.storage</a>
                </li>
                </ul>
              </li><li class="level5">
                    <a href="http://developer.chrome.com/apps/app_identity.html" class="level5 ">User Authentication</a>
              </li>
              </ul>
            </li><li class="level4">
                <a class="button level4" href="javascript:void(0)">
                  <span class="level4">Store and Retrieve Data</span>
                  <div class="toggleIndicator level4"></div>
                </a>
              <ul toggleable="" class="level4 hidden">
              <li class="level5">
                    <a href="http://developer.chrome.com/apps/app_storage.html" class="level5 ">Storage APIs</a>
              </li>
              </ul>
            </li><li class="level4">
                <a class="button level4" href="javascript:void(0)">
                  <span class="level4">Use Low-Level System Services</span>
                  <div class="toggleIndicator level4"></div>
                </a>
              <ul toggleable="" class="level4 hidden">
              <li class="level5">
                    <a href="http://developer.chrome.com/apps/app_usb.html" class="level5 ">USB</a>
              </li><li class="level5">
                    <a href="http://developer.chrome.com/apps/app_serial.html" class="level5 ">Serial</a>
              </li><li class="level5">
                    <a href="http://developer.chrome.com/apps/app_network.html" class="level5 ">Network Communications</a>
              </li>
              </ul>
            </li><li class="level4">
                <a class="button level4" href="javascript:void(0)">
                  <span class="level4">Interact with the Host Platform</span>
                  <div class="toggleIndicator level4"></div>
                </a>
              <ul toggleable="" class="level4 hidden">
              <li class="level5">
                    <a href="http://developer.chrome.com/apps/desktop_notifications.html" class="level5 ">Rich Notifications</a>
              </li>
              </ul>
            </li>
            </ul>
          </li>
          </ul>
        </li><li class="level2">
              <span class="level2">Distribute</span>
          <ul class="level2 ">
          <li class="level3">
                <a href="http://developer.chrome.com/apps/publish_app.html" class="level3 ">Publish Your App</a>
          </li><li class="level3">
              <a class="button level3" href="javascript:void(0)">
                <span class="level3">Monetize Your App</span>
                <div class="toggleIndicator level3"></div>
              </a>
            <ul toggleable="" class="level3 hidden">
            <li class="level4">
                  <a href="http://developer.chrome.com/apps/google_wallet.html" class="level4 ">Google Wallet for Digital Goods</a>
            </li>
            </ul>
          </li><li class="level3">
                <a href="http://developer.chrome.com/apps/analytics.html" class="level3 ">Analytics</a>
          </li>
          </ul>
        </li><li class="level2">
              <span class="level2">Reference</span>
          <ul class="level2 ">
          <li class="level3">
                <a href="http://developer.chrome.com/apps/api_index.html" class="level3 ">Chrome Platform APIs</a>
          </li><li class="level3">
                <a href="http://developer.chrome.com/apps/tags/webview.html" class="level3 ">Webview Tag</a>
          </li><li class="level3">
                <a href="http://developer.chrome.com/apps/api_other.html" class="level3 ">Web APIs</a>
          </li><li class="level3">
                <a href="http://developer.chrome.com/apps/manifest.html" class="level3 ">Manifest File Format</a>
          </li><li class="level3">
                <a href="http://developer.chrome.com/apps/app_deprecated.html" class="level3 ">Disabled Web Features</a>
          </li>
          </ul>
        </li><li class="level2">
              <span class="level2">Samples</span>
          <ul class="level2 ">
          <li class="level3">
                <a href="http://developer.chrome.com/apps/samples.html" class="level3 ">Sample Apps</a>
          </li>
          </ul>
        </li><li class="level2">
              <span class="level2">Help</span>
          <ul class="level2 ">
          <li class="level3">
                <a href="http://developer.chrome.com/apps/faq.html" class="level3 ">FAQ</a>
          </li><li class="level3">
                <a href="https://groups.google.com/a/chromium.org/forum/#!forum/chromium-apps" class="level3 ">Google Groups</a>
          </li><li class="level3">
                <a href="http://stackoverflow.com/questions/tagged/google-chrome-app" class="level3 ">Stack Overflow</a>
          </li>
          </ul>
        </li>
        </ul>
      </div>
      <div id="gc-pagecontent">

<div id="toc">
  <ol>
    <li>
      <a href="http://developer.chrome.com/apps/content_scripts.html#registration" data-list-item="">Manifest</a>
      <ol>
        <li>
          <a href="http://developer.chrome.com/apps/content_scripts.html#match-patterns-globs" data-list-item="">Match patterns and globs</a>
        </li>
      </ol>
    </li>
    <li>
      <a href="http://developer.chrome.com/apps/content_scripts.html#pi" data-list-item="">Programmatic injection</a>
    </li>
    <li>
      <a href="http://developer.chrome.com/apps/content_scripts.html#execution-environment" data-list-item="">Execution environment</a>
    </li>
    <li>
      <a href="http://developer.chrome.com/apps/content_scripts.html#host-page-communication" data-list-item="">Communication with the embedding page</a>
    </li>
    <li>
      <a href="http://developer.chrome.com/apps/content_scripts.html#security-considerations" data-list-item="">Security considerations</a>
    </li>
    <li>
      <a href="http://developer.chrome.com/apps/content_scripts.html#extension-files" data-list-item="">Referring to extension files</a>
    </li>
    <li>
      <a href="http://developer.chrome.com/apps/content_scripts.html#examples" data-list-item=""> Examples </a>
    </li>
    <li>
      <a href="http://developer.chrome.com/apps/content_scripts.html#videos" data-list-item=""> Videos </a>
    </li>
  </ol>
</div>

<h1>Content Scripts</h1>


<p>
Content scripts are JavaScript files that run in the context of web pages.
By using the standard
<a href="http://www.w3.org/TR/DOM-Level-2-HTML/">Document
Object Model</a> (DOM),
they can read details of the web pages the browser visits,
or make changes to them.
</p>

<p>
Here are some examples of what content scripts can do:
</p>

<ul>
  <li>Find unlinked URLs in web pages and convert them into hyperlinks
  </li><li>Increase the font size to make text more legible
  </li><li>Find and process <a href="http://microformats.org/">microformat</a> data in the DOM
</li></ul>

<p>
However, content scripts have some limitations.
They <b>cannot</b>:
</p>

<ul>
  <li>
    Use chrome.* APIs
    (except for parts of
    <a href="http://developer.chrome.com/apps/extension.html"><code>chrome.extension</code></a>)
  </li>
  <li>
    Use variables or functions defined by their extension's pages
  </li>
  <li>
    Use variables or functions defined by web pages or by other content scripts
  </li>
</ul>

<p>
These limitations aren't as bad as they sound.
Content scripts can <em>indirectly</em> use the chrome.* APIs,
get access to extension data,
and request extension actions
by exchanging <a href="http://developer.chrome.com/apps/messaging.html">messages</a>
with their parent extension.
Content scripts can also
make <a href="http://developer.chrome.com/apps/xhr.html">cross-site XMLHttpRequests</a>
to the same sites as their parent extensions,
and they can
<a href="http://developer.chrome.com/apps/content_scripts.html#host-page-communication">communicate with web pages</a>
using the shared DOM.
For more insight into what content scripts can and can't do,
learn about the
<a href="http://developer.chrome.com/apps/content_scripts.html#execution-environment">execution environment</a>.
</p>

<h2 id="registration">Manifest</h2>

<p>If your content script's code should always be injected,
register it in the
<a href="http://developer.chrome.com/apps/manifest.html">extension manifest</a>
using the <code>content_scripts</code> field,
as in the following example.
</p>

<pre data-filename="manifest.json" class="prettyprint"><div class="filename nocode">manifest.json</div><span class="pun">{</span><span class="pln">
  </span><span class="str">"name"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"My extension"</span><span class="pun">,</span><span class="pln">
  </span><span class="pun">...</span><span class="pln">
  </span><b><span class="str">"content_scripts"</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
      </span><span class="str">"matches"</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="str">"http://www.google.com/*"</span><span class="pun">],</span><span class="pln">
      </span><span class="str">"css"</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="str">"mystyles.css"</span><span class="pun">],</span><span class="pln">
      </span><span class="str">"js"</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="str">"jquery.js"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"myscript.js"</span><span class="pun">]</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
  </span><span class="pun">]</span></b><span class="pun">,</span><span class="pln">
  </span><span class="pun">...</span><span class="pln">
</span><span class="pun">}</span></pre>

<p>
If you want to inject the code only sometimes,
use the
<a href="http://developer.chrome.com/apps/declare_permissions.html"><code>permissions</code></a> field instead,
as described in <a href="http://developer.chrome.com/apps/content_scripts.html#pi">Programmatic injection</a>.
</p>

<pre data-filename="manifest.json" class="prettyprint"><div class="filename nocode">manifest.json</div><span class="pun">{</span><span class="pln">
  </span><span class="str">"name"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"My extension"</span><span class="pun">,</span><span class="pln">
  </span><span class="pun">...</span><span class="pln">
  </span><b><span class="str">"permissions"</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">
    </span><span class="str">"tabs"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"http://www.google.com/*"</span><span class="pln">
  </span><span class="pun">]</span></b><span class="pun">,</span><span class="pln">
  </span><span class="pun">...</span><span class="pln">
</span><span class="pun">}</span></pre>

<p>
Using the <code>content_scripts</code> field,
an extension can insert multiple content scripts into a page;
each of these content scripts can have multiple JavaScript and CSS files.
Each item in the <code>content_scripts</code> array
can have the following properties:</p>

<table class="simple">
  <tbody><tr>
    <th>Name</th>
    <th>Type</th>
    <th>Description</th>
  </tr>
  <tr>
    <td><code>matches</code></td>
    <td>array of strings</td>
    <td><em>Required.</em>
    Specifies which pages this content script will be injected into.
    See <a href="http://developer.chrome.com/apps/match_patterns.html">Match Patterns</a>
    for more details on the syntax of these strings
    and <a href="http://developer.chrome.com/apps/content_scripts.html#match-patterns-globs">Match patterns and globs</a>
    for information on how to exclude URLs.</td>
  </tr>
  <tr>
    <td><code>exclude_matches</code></td>
    <td>array of strings</td>
    <td><em>Optional.</em>
    Excludes pages that this content script would otherwise be
    injected into.
    See <a href="http://developer.chrome.com/apps/match_patterns.html">Match Patterns</a>
    for more details on the syntax of these strings
    and <a href="http://developer.chrome.com/apps/content_scripts.html#match-patterns-globs">Match patterns and globs</a>
    for information on how to exclude URLs.</td>
  </tr>
  <tr>
    <td><code>css<code></code></code></td>
    <td>array of strings</td>
    <td><em>Optional.</em>
    The list of CSS files to be injected into matching pages. These are injected in the order they appear in this array, before any DOM is constructed or displayed for the page.</td>
  </tr>
  <tr>
    <td><code>js<code></code></code></td>
    <td><nobr>array of strings</nobr></td>
    <td><em>Optional.</em>
    The list of JavaScript files to be injected into matching pages. These are injected in the order they appear in this array.</td>
  </tr>
  <tr id="run_at">
    <td><code>run_at<code></code></code></td>
    <td>string</td>
    <td><em>Optional.</em>
    Controls when the files in <code>js</code> are injected. Can be "document_start", "document_end", or "document_idle". Defaults to "document_idle".

    <br><br>

    In the case of "document_start", the files are injected after any files from <code>css</code>, but before any other DOM is constructed or any other script is run.

    <br><br>

    In the case of "document_end", the files are injected immediately after the DOM is complete, but before subresources like images and frames have loaded.

    <br><br>

    In the case of "document_idle", the browser chooses a time to inject scripts between "document_end" and immediately after the <code><a href="http://www.whatwg.org/specs/web-apps/current-work/#handler-onload">window.onload</a></code> event fires. The exact moment of injection depends on how complex the document is and how long it is taking to load, and is optimized for page load speed.

    <br><br>

    <b>Note:</b> With "document_idle", content scripts may not necessarily receive the <code>window.onload</code> event, because they may run after it has
    already fired. In most cases, listening for the <code>onload</code> event is unnecessary for content scripts running at "document_idle" because they are guaranteed to run after the DOM is complete. If your script definitely needs to run after <code>window.onload</code>, you can check if <code>onload</code> has already fired by using the <code><a href="http://www.whatwg.org/specs/web-apps/current-work/#dom-document-readystate">document.readyState</a></code> property.</td>
  </tr>
  <tr>
    <td><code>all_frames<code></code></code></td>
    <td>boolean</td>
    <td><em>Optional.</em>
    Controls whether the content script runs in all frames of the matching page, or only the top frame.
    <br><br>
    Defaults to <code>false</code>, meaning that only the top frame is matched.</td>
  </tr>
  <tr>
    <td><code>include_globs</code></td>
    <td>array of string</td>
    <td><em>Optional.</em>
    Applied after <code>matches</code> to include only those URLs that also match this glob. Intended to emulate the <a href="http://wiki.greasespot.net/Metadata_Block#.40include"><code>@include</code></a> Greasemonkey keyword.
    See <a href="http://developer.chrome.com/apps/content_scripts.html#match-patterns-globs">Match patterns and globs</a> below for more details.</td>
  </tr>
  <tr>
    <td><code>exclude_globs</code></td>
    <td>array of string</td>
    <td><em>Optional.</em>
    Applied after <code>matches</code> to exclude URLs that match this glob.
    Intended to emulate the <a href="http://wiki.greasespot.net/Metadata_Block#.40include"><code>@exclude</code></a> Greasemonkey keyword.
    See <a href="http://developer.chrome.com/apps/content_scripts.html#match-patterns-globs">Match patterns and globs</a> below for more details.</td>
  </tr>
</tbody></table>

<h3 id="match-patterns-globs">Match patterns and globs</h3>

<p>
The content script will be injected into a page if its URL matches any <code>matches</code> pattern and any <code>include_globs</code> pattern, as long as the URL doesn't also match an <code>exclude_matches</code> or <code>exclude_globs</code> pattern.

Because the <code>matches</code> property is required, <code>exclude_matches</code>, <code>include_globs</code>, and <code>exclude_globs</code> can only be used to limit which pages will be affected.
</p>

<p>
For example, assume <code>matches</code> is <code>["http://*.nytimes.com/*"]</code>:
</p>
<ul>
<li>If <code>exclude_matches</code> is <code>["*://*/*business*"]</code>, then the content script would be injected into "http://www.nytimes.com/health" but not into "http://www.nytimes.com/business".</li>
<li>If <code>include_globs</code> is <code>["*nytimes.com/???s/*"]</code>, then the content script would be injected into "http:/www.nytimes.com/arts/index.html" and "http://www.nytimes.com/jobs/index.html" but not into "http://www.nytimes.com/sports/index.html".</li>
<li>If <code>exclude_globs</code> is <code>["*science*"]</code>, then the content script would be injected into "http://www.nytimes.com" but not into "http://science.nytimes.com" or "http://www.nytimes.com/science".</li>
</ul>
<p>

</p><p>
Glob properties follow a different, more flexible syntax than <a href="http://developer.chrome.com/apps/match_patterns.html">match patterns</a>.  Acceptable glob strings are URLs that may contain "wildcard" asterisks and question marks. The asterisk (*) matches any string of any length (including the empty string); the question mark (?) matches any single character.
</p>

<p>
For example, the glob "http://???.example.com/foo/*" matches any of the following:
</p>
<ul>
  <li>"http://www.example.com/foo/bar"</li>
  <li>"http://the.example.com/foo/"</li>
</ul>
<p>
However, it does <em>not</em> match the following:
</p>
<ul>
  <li>"http://my.example.com/foo/bar"</li>
  <li>"http://example.com/foo/"</li>
  <li>"http://www.example.com/foo"</li>
</ul>

<h2 id="pi">Programmatic injection</h2>

<p>
Inserting code into a page programmatically is useful
when your JavaScript or CSS code
shouldn't be injected into every single page
that matches the pattern —
for example, if you want a script to run
only when the user clicks a browser action's icon.
</p>

<p>
To insert code into a page,
your extension must have
<a href="http://developer.chrome.com/apps/xhr.html#requesting-permission">cross-origin permissions</a>
for the page.
It also must be able to use the <code>chrome.tabs</code> module.
You can get both kinds of permission
using the manifest file's
<a href="http://developer.chrome.com/apps/declare_permissions.html">permissions</a> field.
</p>

<p>
Once you have permissions set up,
you can inject JavaScript into a page by calling
<a href="http://developer.chrome.com/apps/tabs.html#method-executeScript">tabs.executeScript</a>.
To inject CSS, use
<a href="http://developer.chrome.com/apps/tabs.html#method-insertCSS">tabs.insertCSS</a>.
</p>

<p>
The following code
(from the
<a href="http://src.chromium.org/viewvc/chrome/trunk/src/chrome/common/extensions/docs/examples/api/browserAction/make_page_red/">make_page_red</a> example)
reacts to a user click
by inserting JavaScript into the current tab's page
and executing the script.
</p>

<pre data-filename="background.html" class="prettyprint"><div class="filename nocode">background.html</div><span class="pln">chrome</span><span class="pun">.</span><span class="pln">browserAction</span><span class="pun">.</span><span class="pln">onClicked</span><span class="pun">.</span><span class="pln">addListener</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">tab</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  chrome</span><span class="pun">.</span><span class="pln">tabs</span><span class="pun">.</span><span class="pln">executeScript</span><span class="pun">({</span><span class="pln">
    code</span><span class="pun">:</span><span class="pln"> </span><span class="str">'document.body.style.backgroundColor="red"'</span><span class="pln">
  </span><span class="pun">});</span><span class="pln"> 
</span><span class="pun">});</span></pre>
<pre data-filename="manifest.json" class="prettyprint"><div class="filename nocode">manifest.json</div><span class="str">"permissions"</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">
  </span><span class="str">"activeTab"</span><span class="pln">
</span><span class="pun">],</span></pre>

<p>
When the browser is displaying an HTTP page
and the user clicks this extension's browser action,
the extension sets the page's <code>bgcolor</code> property to 'red'.
The result,
unless the page has CSS that sets the background color,
is that the page turns red.
</p>

<p>
Usually, instead of inserting code directly (as in the previous sample),
you put the code in a file.
You inject the file's contents like this:
</p>

<pre class="prettyprint"><span class="pln">chrome</span><span class="pun">.</span><span class="pln">tabs</span><span class="pun">.</span><span class="pln">executeScript</span><span class="pun">(</span><span class="kwd">null</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{</span><span class="pln">file</span><span class="pun">:</span><span class="pln"> </span><span class="str">"content_script.js"</span><span class="pun">});</span></pre>


<h2 id="execution-environment">Execution environment</h2>

<p>Content scripts execute in a special environment called an <em>isolated world</em>. They have access to the DOM of the page they are injected into, but not to any JavaScript variables or functions created by the page. It looks to each content script as if there is no other JavaScript executing on the page it is running on. The same is true in reverse: JavaScript running on the page cannot call any functions or access any variables defined by content scripts.

</p><p>For example, consider this simple page:

</p><pre data-filename="hello.html" class="prettyprint"><div class="filename nocode">hello.html</div><span class="tag">&lt;html&gt;</span><span class="pln">
  </span><span class="tag">&lt;button</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"mybutton"</span><span class="tag">&gt;</span><span class="pln">click me</span><span class="tag">&lt;/button&gt;</span><span class="pln">
  </span><span class="tag">&lt;script&gt;</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> greeting </span><span class="pun">=</span><span class="pln"> </span><span class="str">"hello, "</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> button </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">getElementById</span><span class="pun">(</span><span class="str">"mybutton"</span><span class="pun">);</span><span class="pln">
    button</span><span class="pun">.</span><span class="pln">person_name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Bob"</span><span class="pun">;</span><span class="pln">
    button</span><span class="pun">.</span><span class="pln">addEventListener</span><span class="pun">(</span><span class="str">"click"</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      alert</span><span class="pun">(</span><span class="pln">greeting </span><span class="pun">+</span><span class="pln"> button</span><span class="pun">.</span><span class="pln">person_name </span><span class="pun">+</span><span class="pln"> </span><span class="str">"."</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">},</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">);</span><span class="pln">
  </span><span class="tag">&lt;/script&gt;</span><span class="pln">
</span><span class="tag">&lt;/html&gt;</span></pre>

<p>Now, suppose this content script was injected into hello.html:

</p><pre data-filename="contentscript.js" class="prettyprint"><div class="filename nocode">contentscript.js</div><span class="kwd">var</span><span class="pln"> greeting </span><span class="pun">=</span><span class="pln"> </span><span class="str">"hola, "</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">var</span><span class="pln"> button </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">getElementById</span><span class="pun">(</span><span class="str">"mybutton"</span><span class="pun">);</span><span class="pln">
button</span><span class="pun">.</span><span class="pln">person_name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Roberto"</span><span class="pun">;</span><span class="pln">
button</span><span class="pun">.</span><span class="pln">addEventListener</span><span class="pun">(</span><span class="str">"click"</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  alert</span><span class="pun">(</span><span class="pln">greeting </span><span class="pun">+</span><span class="pln"> button</span><span class="pun">.</span><span class="pln">person_name </span><span class="pun">+</span><span class="pln"> </span><span class="str">"."</span><span class="pun">);</span><span class="pln">
</span><span class="pun">},</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">);</span></pre>

<p>Now, if the button is pressed, you will see both greetings.

</p><p>Isolated worlds allow each content script to make changes to its JavaScript environment without worrying about conflicting with the page or with other content scripts. For example, a content script could include JQuery v1 and the page could include JQuery v2, and they wouldn't conflict with each other.

</p><p>Another important benefit of isolated worlds is that they completely separate the JavaScript on the page from the JavaScript in extensions. This allows us to offer extra functionality to content scripts that should not be accessible from web pages without worrying about web pages accessing it.

</p><p>It's worth noting what happens with JavaScript objects that are shared by the page and the extension - for example, the <code>window.onload</code> event. Each isolated world sees its own version of the object. Assigning to the object affects your independent copy of the object. For example, both the page and extension can assign to <code>window.onload</code>, but neither one can read the other's event handler. The event handlers are called in the order in which they were assigned.

</p><h2 id="host-page-communication">Communication with the embedding page</h2>

<p>Although the execution environments of content scripts and the pages that host them are isolated from each other, they share access to the page's DOM. If the page wishes to communicate with the content script (or with the extension via the content script), it must do so through the shared DOM.</p>
<p>An example can be accomplished using window.postMessage (or window.webkitPostMessage for Transferable objects):</p>
<pre data-filename="contentscript.js" class="prettyprint"><div class="filename nocode">contentscript.js</div><span class="kwd">var</span><span class="pln"> port </span><span class="pun">=</span><span class="pln"> chrome</span><span class="pun">.</span><span class="pln">runtime</span><span class="pun">.</span><span class="pln">connect</span><span class="pun">();</span><span class="pln">

window</span><span class="pun">.</span><span class="pln">addEventListener</span><span class="pun">(</span><span class="str">"message"</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="kwd">event</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="com">// We only accept messages from ourselves</span><span class="pln">
  </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">event</span><span class="pun">.</span><span class="pln">source </span><span class="pun">!=</span><span class="pln"> window</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">return</span><span class="pun">;</span><span class="pln">

  </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">event</span><span class="pun">.</span><span class="pln">data</span><span class="pun">.</span><span class="pln">type </span><span class="pun">&amp;&amp;</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">event</span><span class="pun">.</span><span class="pln">data</span><span class="pun">.</span><span class="pln">type </span><span class="pun">==</span><span class="pln"> </span><span class="str">"FROM_PAGE"</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">"Content script received: "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="kwd">event</span><span class="pun">.</span><span class="pln">data</span><span class="pun">.</span><span class="pln">text</span><span class="pun">);</span><span class="pln">
    port</span><span class="pun">.</span><span class="pln">postMessage</span><span class="pun">(</span><span class="kwd">event</span><span class="pun">.</span><span class="pln">data</span><span class="pun">.</span><span class="pln">text</span><span class="pun">);</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">},</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">);</span></pre>
<pre data-filename="http://foo.com/example.html" class="prettyprint"><div class="filename nocode">http://foo.com/example.html</div><span class="pln">document</span><span class="pun">.</span><span class="pln">getElementById</span><span class="pun">(</span><span class="str">"theButton"</span><span class="pun">).</span><span class="pln">addEventListener</span><span class="pun">(</span><span class="str">"click"</span><span class="pun">,</span><span class="pln">
    </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  window</span><span class="pun">.</span><span class="pln">postMessage</span><span class="pun">({</span><span class="pln"> type</span><span class="pun">:</span><span class="pln"> </span><span class="str">"FROM_PAGE"</span><span class="pun">,</span><span class="pln"> text</span><span class="pun">:</span><span class="pln"> </span><span class="str">"Hello from the webpage!"</span><span class="pln"> </span><span class="pun">},</span><span class="pln"> </span><span class="str">"*"</span><span class="pun">);</span><span class="pln">
</span><span class="pun">},</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">);</span></pre>
<p>In the above example, example.html (which is not a part of the extension) posts messages to itself, which are intercepted and inspected by the content script, and then posted to the extension process. In this way, the page establishes a line of communication to the extension process. The reverse is possible through similar means.</p>

<h2 id="security-considerations">Security considerations</h2>

<p>When writing a content script, you should be aware of two security issues.
First, be careful not to introduce security vulnerabilities into the web site
your content script is injected into.  For example, if your content script
receives content from another web site (for example, by making an <a href="http://developer.chrome.com/apps/xhr.html">XMLHttpRequest</a>),
be careful to filter that content for <a href="http://en.wikipedia.org/wiki/Cross-site_scripting">cross-site
scripting</a> attacks before injecting the content into the current page.
For example, prefer to inject content via innerText rather than innerHTML.
Be especially careful when retrieving HTTP content on an HTTPS page because
the HTTP content might have been corrupted by a network <a href="http://en.wikipedia.org/wiki/Man-in-the-middle_attack">"man-in-the-middle"</a>
if the user is on a hostile network.</p>

<p>Second, although running your content script in an isolated world provides
some protection from the web page, a malicious web page might still be able
to attack your content script if you use content from the web page
indiscriminately.  For example, the following patterns are dangerous:
</p><pre data-filename="contentscript.js" class="prettyprint"><div class="filename nocode">contentscript.js</div><span class="kwd">var</span><span class="pln"> data </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">getElementById</span><span class="pun">(</span><span class="str">"json-data"</span><span class="pun">)</span><span class="pln">
</span><span class="com">// WARNING! Might be evaluating an evil script!</span><span class="pln">
</span><span class="kwd">var</span><span class="pln"> parsed </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">eval</span><span class="pun">(</span><span class="str">"("</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> data </span><span class="pun">+</span><span class="pln"> </span><span class="str">")"</span><span class="pun">)</span></pre>
<pre data-filename="contentscript.js" class="prettyprint"><div class="filename nocode">contentscript.js</div><span class="kwd">var</span><span class="pln"> elmt_id </span><span class="pun">=</span><span class="pln"> </span><span class="pun">...</span><span class="pln">
</span><span class="com">// WARNING! elmt_id might be "); ... evil script ... //"!</span><span class="pln">
window</span><span class="pun">.</span><span class="pln">setTimeout</span><span class="pun">(</span><span class="str">"animate("</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> elmt_id </span><span class="pun">+</span><span class="pln"> </span><span class="str">")"</span><span class="pun">,</span><span class="pln"> </span><span class="lit">200</span><span class="pun">);</span></pre>
<p>Instead, prefer safer APIs that do not run scripts:</p>
<pre data-filename="contentscript.js" class="prettyprint"><div class="filename nocode">contentscript.js</div><span class="kwd">var</span><span class="pln"> data </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">getElementById</span><span class="pun">(</span><span class="str">"json-data"</span><span class="pun">)</span><span class="pln">
</span><span class="com">// JSON.parse does not evaluate the attacker's scripts.</span><span class="pln">
</span><span class="kwd">var</span><span class="pln"> parsed </span><span class="pun">=</span><span class="pln"> JSON</span><span class="pun">.</span><span class="pln">parse</span><span class="pun">(</span><span class="pln">data</span><span class="pun">);</span></pre>
<pre data-filename="contentscript.js" class="prettyprint"><div class="filename nocode">contentscript.js</div><span class="kwd">var</span><span class="pln"> elmt_id </span><span class="pun">=</span><span class="pln"> </span><span class="pun">...</span><span class="pln">
</span><span class="com">// The closure form of setTimeout does not evaluate scripts.</span><span class="pln">
window</span><span class="pun">.</span><span class="pln">setTimeout</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  animate</span><span class="pun">(</span><span class="pln">elmt_id</span><span class="pun">);</span><span class="pln">
</span><span class="pun">},</span><span class="pln"> </span><span class="lit">200</span><span class="pun">);</span></pre>

<h2 id="extension-files">Referring to extension files</h2>

<p>
Get the URL of an extension's file using
<code>chrome.extension.getURL()</code>.
You can use the result
just like you would any other URL,
as the following code shows.
</p>


<pre class="prettyprint"><em><span class="com">//Code for displaying &lt;extensionDir&gt;/images/myimage.png:</span></em><span class="pln">
</span><span class="kwd">var</span><span class="pln"> imgURL </span><span class="pun">=</span><span class="pln"> </span><b><span class="pln">chrome</span><span class="pun">.</span><span class="pln">extension</span><span class="pun">.</span><span class="pln">getURL</span><span class="pun">(</span><span class="str">"images/myimage.png"</span><span class="pun">)</span></b><span class="pun">;</span><span class="pln">
document</span><span class="pun">.</span><span class="pln">getElementById</span><span class="pun">(</span><span class="str">"someImage"</span><span class="pun">).</span><span class="pln">src </span><span class="pun">=</span><span class="pln"> imgURL</span><span class="pun">;</span></pre>

<h2 id="examples"> Examples </h2>

<p>
You can find many
<a href="http://developer.chrome.com/apps/samples.html#script">examples that use content scripts</a>.
A simple example of communication via messages is in the
<a href="http://developer.chrome.com/apps/samples.html#message-timer">Message Timer</a>.
See <a href="http://developer.chrome.com/apps/samples.html#page-redder">Page Redder</a> and
<a href="http://developer.chrome.com/apps/samples.html#email-this-page-(by-google)">Email This Page</a>
for examples of programmatic injection.
</p>


<h2 id="videos"> Videos </h2>

<p>
The following videos discuss concepts that are important for content scripts.
The first video describes content scripts and isolated worlds.
</p>

<p>
<iframe title="YouTube video player" width="640" height="390" src="./Content Scripts - Google Chrome_files/laLudeUmXHM.htm" frameborder="0" allowfullscreen=""></iframe>
</p>

<p>
The next video describes message passing,
featuring an example of a content script
sending a request to its parent extension.
</p>

<p>
<iframe title="YouTube video player" width="640" height="390" src="./Content Scripts - Google Chrome_files/B4M_a7xejYI.htm" frameborder="0" allowfullscreen=""></iframe>
</p>
      </div>
    </div>
  

  <div id="gc-footer">
    <button class="google-button hidden" id="scroll-to-top">↑</button>
    <button class="google-button" id="send-feedback">Send Feedback</button>
    <div class="text">
      <p>
        Except as otherwise <a href="http://code.google.com/policies.html#restrictions">noted</a>,
        the content of this page is licensed under the <a rel="license" href="http://creativecommons.org/licenses/by/3.0/">Creative Commons
        Attribution 3.0 License</a>, and code samples are licensed under the
        <a rel="license" href="http://code.google.com/google_bsd_license.html">BSD License</a>.
      </p>
      <p>
        ©2013 Google
      </p>
      <script src="./Content Scripts - Google Chrome_files/platform_chooser.js" type="text/javascript"></script>
      <script src="./Content Scripts - Google Chrome_files/popup.js" type="text/javascript"></script>
      <script src="./Content Scripts - Google Chrome_files/prettify.js" type="text/javascript"></script>
      <script src="./Content Scripts - Google Chrome_files/scroll.js" type="text/javascript"></script>
      <script src="./Content Scripts - Google Chrome_files/sidebar.js" type="text/javascript"></script>
      <script src="./Content Scripts - Google Chrome_files/tabs.js" type="text/javascript"></script>
      <script>
        (function() {
          // Auto syntax highlight all pre tags.
          var preElements = document.getElementsByTagName('pre');
          for (var i = 0; i < preElements.length; i++) {
            var preElement = preElements[i];
            preElement.classList.add('prettyprint');
            var datasetFilename = preElement.getAttribute('data-filename');
            if (datasetFilename) {
              var filename = document.createElement('div');
              filename.className = 'filename nocode';
              filename.textContent = datasetFilename;
              preElement.insertBefore(filename, preElement.firstChild);
            }
          }
          prettyPrint();
        })();
      </script>

      <!-- Feedback. -->
      <script type="text/javascript" src="./Content Scripts - Google Chrome_files/api.js"></script>
      <script type="text/javascript">
        (function() {
         document.getElementById('send-feedback').addEventListener('click', function() {
           userfeedback.api.startFeedback({ productId: 86265 });
         });
        })();
      </script>
    </div>
  </div>

</body></html>